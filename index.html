<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ ìœ¤ì„ ìƒ ì¸ìŠ¤íƒ€ê·¸ë¨ ìº¡ì…˜ ì–´ì‹œìŠ¤í„´íŠ¸</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ì´ì „ì— ì œê³µí•œ CSS ìŠ¤íƒ€ì¼ ì „ì²´ í¬í•¨ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .progress-container {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #4CAF50, #45a049);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            padding: 30px;
            margin-bottom: 20px;
        }

        .step {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-header {
            background: linear-gradient(135deg, #f8f9ff, #e8f2ff);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
            display: flex;
            align-items: center;
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .step-title {
            flex: 1;
        }

        .step-title h2 {
            margin: 0;
            color: #444;
            font-size: 1.4em;
        }

        .step-title p {
            margin: 5px 0 0 0;
            color: #666;
            font-size: 0.95em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 12px;
            color: #444;
            font-size: 1.1em;
        }

        .radio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .radio-option {
            background: #f8f9ff;
            border: 2px solid #e1e5f7;
            border-radius: 10px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
        }

        .radio-option:hover {
            border-color: #667eea;
            background: #f0f3ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .radio-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
            accent-color: #667eea;
        }

        .radio-option.selected {
            border-color: #667eea;
            background: #f0f3ff;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .text-input, .textarea-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5f7;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .text-input:focus, .textarea-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .textarea-input {
            resize: vertical;
            min-height: 100px;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .tips-box {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .tips-box h4 {
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .tips-box h4::before {
            content: "ğŸ’¡";
            margin-right: 8px;
            font-size: 1.2em;
        }

        .question-counter {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
            display: inline-block;
        }

        .loading-section {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 30px;
        }

        .caption-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border-left: 5px solid #667eea;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .caption-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .caption-content {
            background: #f8f9ff;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 14px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }

        .hashtags {
            color: #007bff;
            font-weight: 600;
            margin: 15px 0;
            font-size: 13px;
            word-wrap: break-word;
        }

        .copy-btn {
            background: #28a745;
            font-size: 14px;
            padding: 10px 20px;
            border-radius: 20px;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: flex-start;          /* ê°€ìš´ë°ê°€ ì•„ë‹ˆë¼ ìœ„ì— ë¶™ì´ê¸° */
            padding: 20px 10px;               /* ìœ„Â·ì•„ë˜ ì—¬ë°± */

            overflow-y: auto;                 /* ğŸ”‘ íŒì—… ì˜ì—­ ì•ˆì—ì„œ ì„¸ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
            -webkit-overflow-scrolling: touch;/* iOSì—ì„œ ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */            
            z-index: 1000;
        }

        .onboarding-content {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 700px;
            width: 100%;                          /* ëª¨ë°”ì¼ì—ì„œ ì–‘ì˜† ê½‰ ì°¨ê²Œ */
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
            max-height: calc(100vh - 40px);       /* ğŸ”‘ í™”ë©´ ë†’ì´ - ì—¬ë°± ë§Œí¼ë§Œ */
            overflow-y: auto;                     /* ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ì¹´ë“œ ì•ˆì—ì„œ ìŠ¤í¬ë¡¤ */
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .onboarding-content h2 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.8em;
            word-break: keep-all; /* âœ¨ í•œêµ­ì–´ ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ */
        }

        .onboarding-steps {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        @media (max-width: 600px) {
            .onboarding-steps {
                grid-template-columns: 1fr;
            }
        }     

        .onboarding-step {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e1e5f7;
        }

        .onboarding-step .step-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
            display: block;
        }

        .onboarding-step h3 {
            font-size: 1.1em;
            color: #444;
            margin-bottom: 8px;
        }

        .onboarding-step p {
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
            word-break: keep-all; /* â† í•œêµ­ì–´ ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ */
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .result-container {
                grid-template-columns: 1fr;
            }
            
            .radio-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .onboarding-steps {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 480px) {
            .onboarding-steps {
                grid-template-columns: 1fr;
            }
            
            .step-header {
                flex-direction: column;
                text-align: center;
            }
            
            .step-number {
                margin-right: 0;
                margin-bottom: 10px;
            }
        }

        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .hidden { display: none; }
        .error-text { color: #dc3545; font-size: 0.9em; margin-top: 5px; }
    </style>
</head>

<body>
    <!-- ì˜¨ë³´ë”© ì˜¤ë²„ë ˆì´ -->
    <div class="onboarding-overlay" id="onboardingOverlay">
        <div class="onboarding-content">
            <h2>ğŸ¯ 5ë¶„ë§Œ íˆ¬ìí•˜ë©´ AIê°€ ì „ë¬¸ì ì¸ ìº¡ì…˜ì„ ì™„ì„±í•´ë“œë ¤ìš”!</h2>
            <div class="onboarding-steps">
                <div class="onboarding-step">
                    <span class="step-icon">1ï¸âƒ£</span>
                    <h3>ì£¼ì œ ì„ íƒ</h3>
                    <p>ì˜¤ëŠ˜ í¬ìŠ¤íŒ…í•  ë‚´ìš©ì˜ ì£¼ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                </div>
                <div class="onboarding-step">
                    <span class="step-icon">2ï¸âƒ£</span>
                    <h3>ìƒì„¸ ì •ë³´</h3>
                    <p>ì„ íƒí•œ ì£¼ì œì— ë§ëŠ” ëª‡ ê°€ì§€ ì§ˆë¬¸ì— ë‹µí•´ì£¼ì„¸ìš”</p>
                </div>
                <div class="onboarding-step">
                    <span class="step-icon">3ï¸âƒ£</span>
                    <h3>ìŠ¤íƒ€ì¼ ì¡°ì •</h3>
                    <p>ì›í•˜ëŠ” ìº¡ì…˜ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•˜ì„¸ìš”</p>
                </div>
                <div class="onboarding-step">
                    <span class="step-icon">4ï¸âƒ£</span>
                    <h3>AI ìº¡ì…˜ ì™„ì„±</h3>
                    <p>GPT-4ê°€ ìƒì„±í•œ ì „ë¬¸ì ì¸ ìº¡ì…˜ì„ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ì„¸ìš”</p>
                </div>
            </div>
            <button class="btn" onclick="closeOnboarding()">ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ“ ìœ¤ì„ ìƒ ì¸ìŠ¤íƒ€ê·¸ë¨ ìº¡ì…˜ ì–´ì‹œìŠ¤í„´íŠ¸</h1>
            <p>GPT-4 AIì™€ í•¨ê»˜ ì„ ìƒë‹˜ë§Œì˜ ì „ë¬¸ì ì¸ ì¸ìŠ¤íƒ€ê·¸ë¨ ìº¡ì…˜ì„ ì™„ì„±í•´ë³´ì„¸ìš”!</p>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        
        <div class="card">
            <div id="appContainer">
                <!-- ë‹¨ê³„ë³„ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // ë°ì´í„° ì •ì˜ (ì´ì „ê³¼ ë™ì¼)
        const step1Questions = {
            topic: {
                question: "Q1. ì˜¤ëŠ˜ í¬ìŠ¤íŒ…ì˜ ì£¼ì œëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
                options: [
                    "ì„ ìƒë‹˜ ì†Œê°œ", "ìˆ˜ì—… ë°©ì‹", "ìœ¤ì„ ìƒ ì»¤ë¦¬í˜ëŸ¼",
                    "í•™ìƒì˜ ì„±ì¥ ìŠ¤í† ë¦¬", "í•™ìŠµ í›„ê¸°", "í•™ìŠµ íŒ/ë…¸í•˜ìš° ê³µìœ ",
                    "êµìœ¡ ì² í•™/ë°©ë²•ë¡ ", "í•™ë¶€ëª¨ ê³ ë¯¼ í•´ê²°", "ì¼ìƒ/ì„ ìƒë‹˜ ì´ì•¼ê¸°",
                    "ì´ë²¤íŠ¸/ìƒë‹´ ì•ˆë‚´", "ë™ê¸°ë¶€ì—¬/ì‘ì› ë©”ì‹œì§€", "ê¸°íƒ€"
                ]
            },
            target: {
                question: "Q2. ëˆ„êµ¬ì—ê²Œ ë§í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
                options: [
                    "ì´ˆë“±í•™ìƒ í•™ë¶€ëª¨", "ì¤‘í•™ìƒ í•™ë¶€ëª¨",
                    "ì´ˆë“±í•™ìƒ", "ì¤‘í•™ìƒ", "ì—¬ëŸ¬ íƒ€ê²Ÿ"
                ]
            },
            media: {
                question: "Q3. ì˜¤ëŠ˜ ì˜¬ë¦´ ì‚¬ì§„/ì˜ìƒì€ ì–´ë–¤ ë‚´ìš©ì¸ê°€ìš”?",
                type: "textarea",
                placeholder: "ê°„ë‹¨íˆ ì„¤ëª…í•´ì£¼ì„¸ìš” (ì˜ˆ: í•™ìƒì´ ë‹¨ì–´ í…ŒìŠ¤íŠ¸ ë§Œì  ë°›ì€ ë…¸íŠ¸ ì‚¬ì§„)"
            }
        };

        const detailQuestions = {
            "í•™ìƒì˜ ì„±ì¥ ìŠ¤í† ë¦¬": [
                { question: "ëª‡ í•™ë…„ í•™ìƒì¸ê°€ìš”?", type: "text", key: "grade", placeholder: "ì˜ˆ: ì´ˆë“±í•™êµ 5í•™ë…„" },
                { question: "ìœ¤ì„ ìƒìœ¼ë¡œ ì–¼ë§ˆë‚˜ í•™ìŠµí•œ íšŒì›ì¸ê°€ìš”?", type: "text", key: "duration", placeholder: "ì˜ˆ: 1ë…„ 6ê°œì›”" },
                { question: "ì–´ë–¤ ë³€í™”ê°€ ìˆì—ˆë‚˜ìš”? (ì‹¤ë ¥/íƒœë„/ìì‹ ê° ë“±)", type: "textarea", key: "changes", placeholder: "êµ¬ì²´ì ì¸ ë³€í™” ë‚´ìš©ì„ ì•Œë ¤ì£¼ì„¸ìš”" },
                { question: "ì´ í•™ìƒë§Œì˜ íŠ¹ë³„í•œ ì ì€ ë¬´ì—‡ì¸ê°€ìš”?", type: "textarea", key: "special_point", placeholder: "í•™ìƒì˜ ê°œì„±ì´ë‚˜ íŠ¹ì§•ì„ ì•Œë ¤ì£¼ì„¸ìš”" },
                { question: "íšŒì› ì„±ì¥ì— ì„ ìƒë‹˜ì´ ì–´ë–»ê²Œ ë„ì›€ì„ ì£¼ì…¨ë‚˜ìš”?", type: "textarea", key: "teacher_help", placeholder: "ì„ ìƒë‹˜ë§Œì˜ ì§€ë„ ë°©ë²•ì´ë‚˜ ë…¸í•˜ìš°ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”" },
                { question: "íšŒì› ì„±ì¥ì— ìœ¤ì„ ìƒ í•™ìŠµì´ ì–´ë–»ê²Œ ë„ì›€ì´ ë˜ì—ˆë‚˜ìš”?", type: "textarea", key: "yoon_help", placeholder: "ìœ¤ì„ ìƒ ì‹œìŠ¤í…œì˜ ì¥ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì„¸ìš”" }
            ],
            "í•™ìŠµ íŒ/ë…¸í•˜ìš° ê³µìœ ": [
                { question: "ì–´ë–¤ ì˜ì—­ì˜ íŒì¸ê°€ìš”?", type: "radio", options: ["ë‹¨ì–´ ì•”ê¸°", "ë¬¸ë²• ì´í•´", "ë“£ê¸° ì‹¤ë ¥", "ë§í•˜ê¸° ì—°ìŠµ", "í•™ìŠµ ìŠµê´€", "ê¸°íƒ€"], key: "tip_area" },
                { question: "ëˆ„êµ¬ì—ê²Œ ìœ ìš©í•œ íŒì¸ê°€ìš”? (í•™ë…„/ìˆ˜ì¤€)", type: "text", key: "tip_target", placeholder: "ì˜ˆ: ì˜ì–´ ë‹¨ì–´ ì•”ê¸°ë¥¼ ì–´ë ¤ì›Œí•˜ëŠ” ì´ˆë“± ì €í•™ë…„" },
                { question: "êµ¬ì²´ì ì¸ íŒì´ë‚˜ ë…¸í•˜ìš°ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”", type: "textarea", key: "tip_content", placeholder: "ì‹¤ì œë¡œ íš¨ê³¼ë¥¼ ë³¸ êµ¬ì²´ì ì¸ ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”" }
            ],
            "í•™ë¶€ëª¨ ê³ ë¯¼ í•´ê²°": [
                { question: "ì–´ë–¤ ê³ ë¯¼ì„ ë‹¤ë£¨ë‚˜ìš”?", type: "textarea", key: "concern", placeholder: "í•™ë¶€ëª¨ë‹˜ë“¤ì´ ìì£¼ í•˜ì‹œëŠ” ê³ ë¯¼ì„ ì ì–´ì£¼ì„¸ìš”" },
                { question: "ì„ ìƒë‹˜ì˜ í•´ê²°ì±…ì´ë‚˜ ì¡°ì–¸ì€ ë¬´ì—‡ì¸ê°€ìš”?", type: "textarea", key: "advice", placeholder: "ì‹¤ì œë¡œ ë„ì›€ì´ ëœ ì¡°ì–¸ì´ë‚˜ í•´ê²° ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”" }
            ],
            "êµìœ¡ ì² í•™/ë°©ë²•ë¡ ": [
                { question: "ê°•ì¡°í•˜ê³  ì‹¶ì€ ìœ¤ì„ ìƒë§Œì˜ ì¥ì ì€?", type: "radio", options: ["1:1 ë§ì¶¤ í•™ìŠµ", "í¸ì•ˆí•œ ë°©ë¬¸ í•™ìŠµ", "ì²´ê³„ì  ì»¤ë¦¬í˜ëŸ¼", "ì„¸ì‹¬í•œ í•™ìŠµ ê´€ë¦¬", "ê¸°íƒ€"], key: "yoon_advantage" },
                { question: "ì„ ìƒë‹˜ì˜ êµìœ¡ ì² í•™ì„ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”", type: "textarea", key: "philosophy", placeholder: "ì–´ë–¤ ë§ˆìŒê°€ì§ìœ¼ë¡œ í•™ìƒë“¤ì„ ê°€ë¥´ì¹˜ì‹œëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”" }
            ],
            "ì„ ìƒë‹˜ ì†Œê°œ": [
                { question: "ìœ¤ì„ ìƒì„ ì„ íƒí•˜ì‹  ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", type: "textarea", key: "choice_reason", placeholder: "ìœ¤ì„ ìƒì˜ ì–´ë–¤ ì ì´ ë§¤ë ¥ì ì´ì—ˆë‚˜ìš”?" },
                { question: "ìœ¤ì„ ìƒì„ í•˜ë©´ì„œ ê°€ì¥ ë³´ëŒìˆì—ˆë˜ ê¸°ì–µì€ ë¬´ì—‡ì¸ê°€ìš”?", type: "textarea", key: "rewarding_memory", placeholder: "í•™ìƒë“¤ê³¼ì˜ íŠ¹ë³„í•œ ìˆœê°„ì„ ì•Œë ¤ì£¼ì„¸ìš”" },
                { question: "ì„ ìƒë‹˜ì˜ êµìœ¡ì² í•™ì€ ë¬´ì—‡ì¸ê°€ìš”?", type: "textarea", key: "philosophy", placeholder: "ì–´ë–¤ ë§ˆìŒê°€ì§ìœ¼ë¡œ í•™ìƒë“¤ì„ ê°€ë¥´ì¹˜ì‹œë‚˜ìš”?" },
                { question: "ì„ ìƒë‹˜ì˜ ê°•ì ì€ ë¬´ì—‡ì´ë¼ê³  ìƒê°í•˜ì‹œë‚˜ìš”?", type: "textarea", key: "strength", placeholder: "ë‹¤ë¥¸ ì„ ìƒë‹˜ë“¤ê³¼ ì°¨ë³„í™”ë˜ëŠ” ì ì´ ìˆë‹¤ë©´?" },
                { question: "ì–´ë–¤ í•™ìƒë“¤ì´ ì„ ìƒë‹˜ê³¼ ê³µë¶€í•˜ë©´ íš¨ê³¼ì ì¸ê°€ìš”?", type: "textarea", key: "effective_students", placeholder: "ì„ ìƒë‹˜ ìˆ˜ì—…ì´ íŠ¹íˆ ë„ì›€ì´ ë˜ëŠ” í•™ìƒ ìœ í˜•ì€?" }
            ],
            "ìˆ˜ì—… ë°©ì‹": [
                { question: "ë§¤ì¼í•™ìŠµ ë£¨í‹´ì¸ê°€ìš”? ë˜ëŠ” íŠ¹ì • ì˜ì—­ì˜ í•™ìŠµì¸ê°€ìš”?", type: "radio", options: ["ë§¤ì¼í•™ìŠµ ë£¨í‹´", "íŠ¹ì • ì˜ì—­ í•™ìŠµ"], key: "class_type" },
                { question: "ìˆ˜ì—…ì€ ì–´ë–»ê²Œ ì§„í–‰ë˜ë‚˜ìš”?", type: "textarea", key: "class_process", placeholder: "ìˆ˜ì—… ì§„í–‰ ë°©ì‹ì„ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”" },
                { question: "ìœ¤ì„ ìƒ í•™ìŠµì˜ íŠ¹ì§•ì€ ë¬´ì—‡ì¸ê°€ìš”?", type: "textarea", key: "yoon_feature", placeholder: "ë‹¤ë¥¸ í•™ìŠµë²•ê³¼ êµ¬ë³„ë˜ëŠ” ìœ¤ì„ ìƒë§Œì˜ íŠ¹ì§•ì€?" },
                { question: "ì´ëŸ° ìˆ˜ì—…ìœ¼ë¡œ ì–´ë–¤ ë³€í™”ë¥¼ ë³´ì…¨ë‚˜ìš”?", type: "textarea", key: "class_result", placeholder: "í•™ìƒë“¤ì˜ ì‹¤ì œ ë³€í™” ì‚¬ë¡€ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”" }
            ],
            "í•™ìŠµ í›„ê¸°": [
                { question: "ì–´ë–¤ íšŒì›ì˜ í•™ìŠµ í›„ê¸°ì¸ê°€ìš”? (í•™ë…„, í•™ìŠµê³¼ì •)", type: "text", key: "member_info", placeholder: "ì˜ˆ: ì´ˆë“± 4í•™ë…„, ìœ¤ì„ ìƒ 1ë…„ì°¨" },
                { question: "íšŒì›ì˜ í›„ê¸°ì¸ê°€ìš”? í•™ë¶€ëª¨ì˜ í›„ê¸°ì¸ê°€ìš”?", type: "radio", options: ["íšŒì›(í•™ìƒ) í›„ê¸°", "í•™ë¶€ëª¨ í›„ê¸°"], key: "review_type" },
                { question: "ì´ í›„ê¸°ì—ì„œ ì„ ìƒë‹˜ì´ ê°ë™ë°›ì€ í¬ì¸íŠ¸ê°€ ìˆë‚˜ìš”?", type: "textarea", key: "touching_point", placeholder: "ì–´ë–¤ ë¶€ë¶„ì´ ê°€ì¥ ì¸ìƒê¹Šì—ˆë‚˜ìš”?" },
                { question: "ì´ í›„ê¸°ì—ì„œ ë¶€ê°ì‹œí‚¤ê³  ì‹¶ì€ í¬ì¸íŠ¸ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", type: "textarea", key: "highlight_point", placeholder: "ë‹¤ë¥¸ í•™ë¶€ëª¨ë‚˜ í•™ìƒë“¤ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë©”ì‹œì§€ëŠ”?" }
            ],
            "ìœ¤ì„ ìƒ ì»¤ë¦¬í˜ëŸ¼": [
                { question: "ì–´ë–¤ ê³¼ì •/ë ˆë²¨ì¸ê°€ìš”?", type: "text", key: "course_level", placeholder: "ì˜ˆ: ì´ˆê¸‰ ìŠ¤í”¼í‚¹ ê³¼ì •, ì¤‘ê¸‰ ë¦¬ë”© ê³¼ì •" },
                { question: "ì»¤ë¦¬í˜ëŸ¼ êµ¬ì„±/ì§„í–‰ ë°©ì‹ì€?", type: "textarea", key: "curriculum_structure", placeholder: "ë‹¨ê³„ë³„ í•™ìŠµ ê³¼ì •ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”" },
                { question: "ê¸°ëŒ€ íš¨ê³¼ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", type: "textarea", key: "expected_outcome", placeholder: "ì´ ì»¤ë¦¬í˜ëŸ¼ìœ¼ë¡œ ì–´ë–¤ ì‹¤ë ¥ í–¥ìƒì„ ê¸°ëŒ€í•  ìˆ˜ ìˆë‚˜ìš”?" }
            ],
            "ì´ë²¤íŠ¸/ìƒë‹´ ì•ˆë‚´": [
                { question: "ë¬´ìŠ¨ ì´ë²¤íŠ¸/ì•ˆë‚´ì¸ê°€ìš”?", type: "text", key: "event_type", placeholder: "ì˜ˆ: ë¬´ë£Œ í•™ìŠµ ìƒë‹´, ì‹ ê·œ íšŒì› ì´ë²¤íŠ¸" },
                { question: "í˜œíƒ/í¬ì¸íŠ¸ëŠ” ë¬´ì—‡ì¸ê°€ìš”?", type: "textarea", key: "benefit", placeholder: "ì–´ë–¤ í˜œíƒì´ë‚˜ ì¥ì ì´ ìˆëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”" },
                { question: "ì‹ ì²­/ë¬¸ì˜ ë°©ë²•ì€?", type: "text", key: "how_to_apply", placeholder: "ì˜ˆ: DM, ëŒ“ê¸€, ì „í™”ë²ˆí˜¸" },
                { question: "ê¸°ê°„/ë§ˆê°ì€?", type: "text", key: "deadline", placeholder: "ì˜ˆ: ì´ë²ˆ ì£¼ê¹Œì§€, ì„ ì°©ìˆœ 10ëª…" }
            ],
            "ì¼ìƒ/ì„ ìƒë‹˜ ì´ì•¼ê¸°": [
                { question: "ì–´ë–¤ ì¼ìƒì´ì•¼ê¸°/ì—í”¼ì†Œë“œì¸ê°€ìš”?", type: "textarea", key: "daily_story", placeholder: "ì˜¤ëŠ˜ ìˆì—ˆë˜ íŠ¹ë³„í•œ ìˆœê°„ì´ë‚˜ ì—í”¼ì†Œë“œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”" },
                { question: "ì—¬ê¸°ì„œ ì „í•˜ê³  ì‹¶ì€ ë©”ì‹œì§€ëŠ”?", type: "textarea", key: "message", placeholder: "ì´ ì´ì•¼ê¸°ë¥¼ í†µí•´ ì „ë‹¬í•˜ê³  ì‹¶ì€ êµìœ¡ì  ë©”ì‹œì§€ëŠ”?" }
            ],
            "ë™ê¸°ë¶€ì—¬/ì‘ì› ë©”ì‹œì§€": [
                { question: "ëˆ„êµ¬ì—ê²Œ ì „í•˜ë‚˜ìš”?", type: "text", key: "message_target", placeholder: "ì˜ˆ: ì‹œí—˜ ì•ë‘” ì¤‘1 í•™ìƒë“¤, ì˜ì–´ ê³µë¶€ê°€ í˜ë“  ì´ˆë“±í•™ìƒë“¤" },
                { question: "í•µì‹¬ ë©”ì‹œì§€ë¥¼ ì ì–´ì£¼ì„¸ìš”", type: "textarea", key: "core_message", placeholder: "ì–´ë–¤ ì‘ì›ê³¼ ê²©ë ¤ë¥¼ ì „í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?" }
            ]
        };

        const styleOptions = {
            length: {
                question: "ìº¡ì…˜ ê¸¸ì´ë¥¼ ì–´ë–»ê²Œ í• ê¹Œìš”?",
                options: ["ì§§ê²Œ (3-8ì¤„)", "ë³´í†µ (5-15ì¤„)", "ê¸¸ê²Œ (10-25ì¤„)"],
                default: "ë³´í†µ (5-15ì¤„)"
            },
            tone: {
                question: "ìº¡ì…˜ì˜ í†¤ì•¤ë§¤ë„ˆëŠ”ìš”?",
                options: ["ë”°ëœ»í•˜ê³  ì „ë¬¸ì ", "ì¹œê·¼í•˜ê³  í¸ì•ˆí•¨", "ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê°"],
                default: "ë”°ëœ»í•˜ê³  ì „ë¬¸ì "
            },
            emoji: {
                question: "ì´ëª¨ì§€ ì‚¬ìš©ì€ ì–´ë–»ê²Œ í• ê¹Œìš”?",
                options: ["ì ë‹¹íˆ ì‚¬ìš©", "ë§ì´ ì‚¬ìš©", "ìµœì†Œí•œë§Œ ì‚¬ìš©"],
                default: "ì ë‹¹íˆ ì‚¬ìš©"
            }
        };

        // CaptionAssistant í´ë˜ìŠ¤ (API í˜¸ì¶œ ë²„ì „)
        class CaptionAssistant {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 4;
                this.userData = {
                    step1: {},
                    details: {},
                    style: {},
                    special: {}
                };
                this.currentDetailQuestionIndex = 0;
                this.detailQuestionsForTopic = [];
                this.appContainer = document.getElementById('appContainer');
                this.progressBar = document.getElementById('progressBar');
            }

            init() {
                this.renderCurrentStep();
                this.updateProgress();
            }

            updateProgress() {
                const progress = ((this.currentStep - 1) / (this.totalSteps - 1)) * 100;
                this.progressBar.style.width = `${progress}%`;
            }

            renderCurrentStep() {
                this.appContainer.innerHTML = '';
                let stepContent = '';

                switch (this.currentStep) {
                    case 1:
                        stepContent = this.renderStep1();
                        break;
                    case 2:
                        stepContent = this.renderStep2();
                        break;
                    case 3:
                        stepContent = this.renderStep3();
                        break;
                    case 4:
                        stepContent = this.renderStep4();
                        break;
                    default:
                        stepContent = '<p>ì•Œ ìˆ˜ ì—†ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.</p>';
                }
                
                this.appContainer.innerHTML = stepContent;
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.querySelectorAll('.radio-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        const radio = option.querySelector('input[type="radio"]');
                        if (radio) {
                            const name = radio.name;
                            document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                                r.closest('.radio-option').classList.remove('selected');
                            });
                            option.classList.add('selected');
                            radio.checked = true;
                        }
                    });
                });
            }

            // ë‹¨ê³„ë³„ ë Œë”ë§ ë©”ì„œë“œë“¤ (ì´ì „ê³¼ ë™ì¼)
            renderStep1() {
                const topicOptions = step1Questions.topic.options.map((option, idx) => `
                    <div class="radio-option ${this.userData.step1.topic === option ? 'selected' : ''}">
                        <input type="radio" id="topic_${idx}" name="topic" value="${option}" ${this.userData.step1.topic === option ? 'checked' : ''}>
                        <label for="topic_${idx}">${option}</label>
                    </div>
                `).join('');

                const targetOptions = step1Questions.target.options.map((option, idx) => `
                    <div class="radio-option ${this.userData.step1.target === option ? 'selected' : ''}">
                        <input type="radio" id="target_${idx}" name="target" value="${option}" ${this.userData.step1.target === option ? 'checked' : ''}>
                        <label for="target_${idx}">${option}</label>
                    </div>
                `).join('');

                return `
                    <div class="step active">
                        <div class="step-header">
                            <span class="step-number">1</span>
                            <div class="step-title">
                                <h2>ê¸°ë³¸ ì •ë³´ íŒŒì•…</h2>
                                <p>ë¨¼ì € ì´ 3ê°€ì§€ë§Œ ì•Œë ¤ì£¼ì„¸ìš”</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>${step1Questions.topic.question}</label>
                            <div class="radio-grid">${topicOptions}</div>
                            <div class="error-text" id="error-topic"></div>
                        </div>

                        <div class="form-group">
                            <label>${step1Questions.target.question}</label>
                            <div class="radio-grid">${targetOptions}</div>
                            <div class="error-text" id="error-target"></div>
                        </div>

                        <div class="form-group">
                            <label>${step1Questions.media.question}</label>
                            <textarea id="media_description" class="textarea-input" placeholder="${step1Questions.media.placeholder}">${this.userData.step1.media || ''}</textarea>
                            <div class="error-text" id="error-media"></div>
                        </div>

                        <div class="button-group">
                            <div></div>
                            <button class="btn" onclick="assistant.goToNextStep()">ë‹¤ìŒ ë‹¨ê³„</button>
                        </div>
                    </div>
                `;
            }

            renderStep2() {
                const topic = this.userData.step1.topic;
                this.detailQuestionsForTopic = detailQuestions[topic] || [];

                if (this.detailQuestionsForTopic.length === 0) {
                    return `
                        <div class="step active">
                            <div class="step-header">
                                <span class="step-number">2</span>
                                <div class="step-title">
                                    <h2>ë§ì¶¤ ì§ˆë¬¸</h2>
                                    <p>ì„ íƒí•˜ì‹  ì£¼ì œì— ëŒ€í•œ ì¶”ê°€ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</p>
                                </div>
                            </div>
                            <div class="tips-box">
                                <h4>ì¢‹ìŠµë‹ˆë‹¤!</h4>
                                <p>ì„ íƒí•˜ì‹  ì£¼ì œëŠ” ê¸°ë³¸ ì •ë³´ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•œ ìº¡ì…˜ì„ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”. ë°”ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•´ì£¼ì„¸ìš”.</p>
                            </div>
                            <div class="button-group">
                                <button class="btn btn-secondary" onclick="assistant.goToPrevStep()">ì´ì „</button>
                                <button class="btn" onclick="assistant.goToNextStep()">ë‹¤ìŒ ë‹¨ê³„</button>
                            </div>
                        </div>
                    `;
                }

                const currentQ = this.detailQuestionsForTopic[this.currentDetailQuestionIndex];
                let inputHtml = '';

                if (currentQ.type === 'text') {
                    inputHtml = `<input type="text" id="detail_input" class="text-input" placeholder="${currentQ.placeholder || 'ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'}" value="${this.userData.details[currentQ.key] || ''}">`;
                } else if (currentQ.type === 'textarea') {
                    inputHtml = `<textarea id="detail_input" class="textarea-input" placeholder="${currentQ.placeholder || 'ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'}">${this.userData.details[currentQ.key] || ''}</textarea>`;
                } else if (currentQ.type === 'radio') {
                    const radioOptions = currentQ.options.map((option, idx) => `
                        <div class="radio-option ${this.userData.details[currentQ.key] === option ? 'selected' : ''}">
                            <input type="radio" id="detail_${currentQ.key}_${idx}" name="detail_input" value="${option}" ${this.userData.details[currentQ.key] === option ? 'checked' : ''}>
                            <label for="detail_${currentQ.key}_${idx}">${option}</label>
                        </div>
                    `).join('');
                    inputHtml = `<div class="radio-grid">${radioOptions}</div>`;
                }

                const isLastDetailQuestion = this.currentDetailQuestionIndex === this.detailQuestionsForTopic.length - 1;
                const nextButtonText = isLastDetailQuestion ? "ë‹¤ìŒ ë‹¨ê³„" : "ë‹¤ìŒ ì§ˆë¬¸";

                return `
                    <div class="step active">
                        <div class="step-header">
                            <span class="step-number">2</span>
                            <div class="step-title">
                                <h2>ë§ì¶¤ ì§ˆë¬¸</h2>
                                <p>ì„ íƒí•˜ì‹  ì£¼ì œì— ëŒ€í•œ ìƒì„¸ ì§ˆë¬¸ì…ë‹ˆë‹¤</p>
                            </div>
                        </div>

                        <div class="question-counter">
                            ì§ˆë¬¸ ${this.currentDetailQuestionIndex + 1} / ${this.detailQuestionsForTopic.length}
                        </div>

                        <div class="tips-box">
                            <h4>ë” ì¢‹ì€ ìº¡ì…˜ì„ ìœ„í•œ íŒ</h4>
                            <p>ìƒì„¸í•˜ê²Œ ì•Œë ¤ì£¼ì‹¤ìˆ˜ë¡ ë” í’ì„±í•˜ê³  ê°œì„±ìˆëŠ” ìº¡ì…˜ì„ ë§Œë“¤ì–´ ë“œë¦´ ìˆ˜ ìˆì–´ìš”!</p>
                        </div>

                        <div class="form-group">
                            <label>ğŸ“Œ ${currentQ.question}</label>
                            ${inputHtml}
                            <div class="error-text" id="error-detail"></div>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-secondary" onclick="assistant.goToPrevStep()">ì´ì „</button>
                            <button class="btn" onclick="assistant.goToNextDetailQuestion()">${nextButtonText}</button>
                        </div>
                    </div>
                `;
            }

            renderStep3() {
                const lengthOptions = styleOptions.length.options.map((option, idx) => `
                    <div class="radio-option ${(this.userData.style.length === option || (!this.userData.style.length && option === styleOptions.length.default)) ? 'selected' : ''}">
                        <input type="radio" id="length_${idx}" name="length" value="${option}" ${(this.userData.style.length === option || (!this.userData.style.length && option === styleOptions.length.default)) ? 'checked' : ''}>
                        <label for="length_${idx}">${option}</label>
                    </div>
                `).join('');

                const toneOptions = styleOptions.tone.options.map((option, idx) => `
                    <div class="radio-option ${(this.userData.style.tone === option || (!this.userData.style.tone && option === styleOptions.tone.default)) ? 'selected' : ''}">
                        <input type="radio" id="tone_${idx}" name="tone" value="${option}" ${(this.userData.style.tone === option || (!this.userData.style.tone && option === styleOptions.tone.default)) ? 'checked' : ''}>
                        <label for="tone_${idx}">${option}</label>
                    </div>
                `).join('');

                const emojiOptions = styleOptions.emoji.options.map((option, idx) => `
                    <div class="radio-option ${(this.userData.style.emoji === option || (!this.userData.style.emoji && option === styleOptions.emoji.default)) ? 'selected' : ''}">
                        <input type="radio" id="emoji_${idx}" name="emoji" value="${option}" ${(this.userData.style.emoji === option || (!this.userData.style.emoji && option === styleOptions.emoji.default)) ? 'checked' : ''}>
                        <label for="emoji_${idx}">${option}</label>
                    </div>
                `).join('');

                return `
                    <div class="step active">
                        <div class="step-header">
                            <span class="step-number">3</span>
                            <div class="step-title">
                                <h2>ìŠ¤íƒ€ì¼ í™•ì¸ (ì„ íƒì‚¬í•­)</h2>
                                <p>ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì‘ì„±í•˜ë˜, ì›í•˜ì‹œë©´ ì¡°ì •í•  ìˆ˜ ìˆì–´ìš”</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>${styleOptions.length.question}</label>
                            <div class="radio-grid">${lengthOptions}</div>
                        </div>

                        <div class="form-group">
                            <label>${styleOptions.tone.question}</label>
                            <div class="radio-grid">${toneOptions}</div>
                        </div>

                        <div class="form-group">
                            <label>${styleOptions.emoji.question}</label>
                            <div class="radio-grid">${emojiOptions}</div>
                        </div>

                        <div class="form-group">
                            <label>ê¼­ í¬í•¨í–ˆìœ¼ë©´ í•˜ëŠ” ë‚´ìš© (ì„ íƒì‚¬í•­)</label>
                            <textarea id="must_include" class="textarea-input" placeholder="ì˜ˆ: ë¬´ë£Œ ìƒë‹´ ê°€ëŠ¥, ì²« ë‹¬ í•™ìŠµ ë£¨í‹´ ì œê³µ">${this.userData.special.must_include || ''}</textarea>
                        </div>

                        <div class="form-group">
                            <label>ì œì™¸í–ˆìœ¼ë©´ í•˜ëŠ” í‘œí˜„ (ì„ íƒì‚¬í•­)</label>
                            <textarea id="must_avoid" class="textarea-input" placeholder="ì˜ˆ: '100% ë³´ì¥', 'ë¬´ì¡°ê±´ ì„±ì ìƒìŠ¹'">${this.userData.special.must_avoid || ''}</textarea>
                        </div>

                        <div class="form-group">
                            <label>ì§€ì—­ ì •ë³´ (í•´ì‹œíƒœê·¸ìš©, ì„ íƒì‚¬í•­)</label>
                            <input type="text" id="region_info" class="text-input" placeholder="ì˜ˆ: ë¶„ë‹¹, í•´ìš´ëŒ€, ì¼ì‚°" value="${this.userData.special.region || ''}">
                        </div>

                        <div class="button-group">
                            <button class="btn btn-secondary" onclick="assistant.goToPrevStep()">ì´ì „</button>
                            <button class="btn" onclick="assistant.generateCaption()">AI ìº¡ì…˜ ìƒì„±í•˜ê¸°</button>
                        </div>
                    </div>
                `;
            }

            renderStep4() {
                return `
                    <div class="step active">
                        <div class="step-header">
                            <span class="step-number">4</span>
                            <div class="step-title">
                                <h2>AI ìº¡ì…˜ ìƒì„± ì¤‘...</h2>
                                <p>GPT-4ê°€ ì„ ìƒë‹˜ì˜ ì†Œì¤‘í•œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì „ë¬¸ì ì¸ ìº¡ì…˜ì„ ë§Œë“¤ê³  ìˆì–´ìš”</p>
                            </div>
                        </div>
                        
                        <div class="loading-section" id="loadingSection">
                            <div class="spinner"></div>
                            <h3>âœ¨ GPT-4ê°€ ì „ë¬¸ì ì¸ ìº¡ì…˜ì„ ìƒì„±í•˜ê³  ìˆì–´ìš”</h3>
                            <p>10ë…„ êµìœ¡ ì½˜í…ì¸  ì „ë¬¸ê°€ì˜ ë…¸í•˜ìš°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‘ ê°€ì§€ ë²„ì „ì˜ ìº¡ì…˜ì„ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤...</p>
                        </div>
                        
                        <div id="resultSection" class="hidden">
                            <!-- AI ìƒì„± ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                `;
            }

            // ë°ì´í„° ìˆ˜ì§‘ ë©”ì„œë“œë“¤ (ì´ì „ê³¼ ë™ì¼)
            collectStep1Data() {
                const topic = document.querySelector('input[name="topic"]:checked')?.value;
                const target = document.querySelector('input[name="target"]:checked')?.value;
                const media = document.getElementById('media_description')?.value?.trim();

                let isValid = true;
                
                if (!topic) {
                    document.getElementById('error-topic').textContent = "ì£¼ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.";
                    isValid = false;
                } else {
                    document.getElementById('error-topic').textContent = "";
                }
                
                if (!target) {
                    document.getElementById('error-target').textContent = "ëŒ€ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.";
                    isValid = false;
                } else {
                    document.getElementById('error-target').textContent = "";
                }
                
                if (!media) {
                    document.getElementById('error-media').textContent = "ì‚¬ì§„/ì˜ìƒ ë‚´ìš©ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.";
                    isValid = false;
                } else {
                    document.getElementById('error-media').textContent = "";
                }

                if (isValid) {
                    this.userData.step1 = { topic, target, media };
                    return true;
                }
                return false;
            }

            collectDetailQuestionData() {
                const currentQ = this.detailQuestionsForTopic[this.currentDetailQuestionIndex];
                if (!currentQ) return true;

                let value;
                if (currentQ.type === 'radio') {
                    value = document.querySelector('input[name="detail_input"]:checked')?.value;
                } else {
                    value = document.getElementById('detail_input')?.value?.trim();
                }

                this.userData.details[currentQ.key] = value || '';
                return true;
            }

            collectStep3Data() {
                this.userData.style = {
                    length: document.querySelector('input[name="length"]:checked')?.value || styleOptions.length.default,
                    tone: document.querySelector('input[name="tone"]:checked')?.value || styleOptions.tone.default,
                    emoji: document.querySelector('input[name="emoji"]:checked')?.value || styleOptions.emoji.default
                };

                this.userData.special = {
                    must_include: document.getElementById('must_include')?.value?.trim() || '',
                    must_avoid: document.getElementById('must_avoid')?.value?.trim() || '',
                    region: document.getElementById('region_info')?.value?.trim() || ''
                };

                return true;
            }

            // ë„¤ë¹„ê²Œì´ì…˜ ë©”ì„œë“œë“¤ (ì´ì „ê³¼ ë™ì¼)
            goToNextStep() {
                let canProceed = false;

                if (this.currentStep === 1) {
                    canProceed = this.collectStep1Data();
                    if (canProceed) {
                        this.detailQuestionsForTopic = detailQuestions[this.userData.step1.topic] || [];
                        this.currentDetailQuestionIndex = 0;
                    }
                } else if (this.currentStep === 2) {
                    canProceed = true;
                } else if (this.currentStep === 3) {
                    canProceed = this.collectStep3Data();
                }

                if (canProceed && this.currentStep < this.totalSteps) {
                    this.currentStep++;
                    this.renderCurrentStep();
                    this.updateProgress();
                }
            }

            goToPrevStep() {
                if (this.currentStep > 1) {
                    if (this.currentStep === 2) {
                        this.currentDetailQuestionIndex = 0;
                    }
                    
                    this.currentStep--;
                    this.renderCurrentStep();
                    this.updateProgress();
                }
            }

            goToNextDetailQuestion() {
                this.collectDetailQuestionData();

                if (this.currentDetailQuestionIndex < this.detailQuestionsForTopic.length - 1) {
                    this.currentDetailQuestionIndex++;
                    this.renderCurrentStep();
                } else {
                    this.goToNextStep();
                }
            }

            // í•µì‹¬: ì‹¤ì œ API í˜¸ì¶œë¡œ ìº¡ì…˜ ìƒì„±
            async generateCaption() {
                this.collectStep3Data();
                this.currentStep = 4;
                this.renderCurrentStep();
                this.updateProgress();

                try {
                    // Vercel ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ í˜¸ì¶œ
                    const response = await fetch('/api/generate-caption', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(this.userData)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `HTTP ${response.status}: ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`);
                    }

                    const results = await response.json();
                    this.showResults(results);

                } catch (error) {
                    console.error('ìº¡ì…˜ ìƒì„± ì˜¤ë¥˜:', error);
                    this.showError(error.message);
                }
            }

            showResults(results) {
                const resultHTML = `
                    <div class="result-container">
                        <div class="caption-card">
                            <h3>ğŸ“ ë²„ì „ A: ê³µê°ê³¼ ìŠ¤í† ë¦¬í…”ë§ ì¤‘ì‹¬</h3>
                            <div class="caption-content" id="captionA_content">${results.versionA.caption}</div>
                            <div class="hashtags" id="captionA_hashtags">${results.versionA.hashtags}</div>
                            <button class="btn copy-btn" onclick="assistant.copyCaption('A')">ìº¡ì…˜ ë³µì‚¬í•˜ê¸°</button>
                        </div>
                        
                        <div class="caption-card">
                            <h3>ğŸ’¼ ë²„ì „ B: í•µì‹¬ ë©”ì‹œì§€ì™€ ì‹¤ìš©ì„± ì¤‘ì‹¬</h3>
                            <div class="caption-content" id="captionB_content">${results.versionB.caption}</div>
                            <div class="hashtags" id="captionB_hashtags">${results.versionB.hashtags}</div>
                            <button class="btn copy-btn" onclick="assistant.copyCaption('B')">ìº¡ì…˜ ë³µì‚¬í•˜ê¸°</button>
                        </div>
                    </div>
                    
                    <div class="button-group text-center mt-20">
                        <button class="btn btn-secondary" onclick="assistant.restart()">ìƒˆë¡œ ë§Œë“¤ê¸°</button>
                    </div>
                `;

                document.getElementById('loadingSection').classList.add('hidden');
                document.getElementById('resultSection').innerHTML = resultHTML;
                document.getElementById('resultSection').classList.remove('hidden');
            }

            showError(message) {
                const errorHTML = `
                    <div class="error-message">
                        <h3>âš ï¸ ìº¡ì…˜ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h3>
                        <p>${message}</p>
                        <div class="mt-20">
                            <button class="btn btn-secondary" onclick="assistant.goToPrevStep()">ì´ì „ ë‹¨ê³„ë¡œ</button>
                            <button class="btn" onclick="assistant.generateCaption()" style="margin-left: 10px;">ë‹¤ì‹œ ì‹œë„</button>
                        </div>
                    </div>
                `;

                document.getElementById('loadingSection').classList.add('hidden');
                document.getElementById('resultSection').innerHTML = errorHTML;
                document.getElementById('resultSection').classList.remove('hidden');
            }

// ìº¡ì…˜ ë³µì‚¬ (í´ë¦½ë³´ë“œ API + Fallback)
async copyCaption(version) {
    const captionContent = document.getElementById(`caption${version}_content`).innerText;
    const hashtags = document.getElementById(`caption${version}_hashtags`).innerText;
    const fullText = captionContent + '\n\n' + hashtags;

    // ë²„íŠ¼ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° (eventê°€ ì—†ì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ë³´ì™„)
    const button = (typeof event !== 'undefined' && event.target) 
        ? event.target 
        : document.activeElement;

    const showSuccessUI = () => {
        if (!button) return;
        const originalText = button.textContent;
        button.textContent = 'ë³µì‚¬ë¨! âœ…';
        button.style.background = '#218838';
        setTimeout(() => {
            button.textContent = originalText;
            button.style.background = '#28a745';
        }, 2000);
    };

    try {
        // 1) ìµœì‹  í´ë¦½ë³´ë“œ API (HTTPS & ì§€ì› ë¸Œë¼ìš°ì €)
        if (navigator.clipboard && window.isSecureContext) {
            await navigator.clipboard.writeText(fullText);
        } else {
            // 2) Fallback: textarea + execCommand
            const textarea = document.createElement('textarea');
            textarea.value = fullText;
            textarea.style.position = 'fixed';
            textarea.style.top = '-9999px';
            textarea.style.left = '-9999px';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        showSuccessUI();
    } catch (err) {
        console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
    }
}
            restart() {
                this.currentStep = 1;
                this.userData = { step1: {}, details: {}, style: {}, special: {} };
                this.currentDetailQuestionIndex = 0;
                this.detailQuestionsForTopic = [];
                this.renderCurrentStep();
                this.updateProgress();
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë“¤
        function closeOnboarding() {
            document.getElementById('onboardingOverlay').style.display = 'none';
        }

        // ì•± ì´ˆê¸°í™”
        const assistant = new CaptionAssistant();

        window.addEventListener('DOMContentLoaded', () => {
            assistant.init();
        });
    </script>
</body>
</html>
